<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏≠‡∏á</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
      background-color: #f0f0f0;
    }
    h2 { text-align: center; }
    .row {
      background-color: #fff;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 10px;
      transition: background-color 0.3s;
    }
    input[type=file], input[type=number], button {
      display: block;
      margin-top: 0.5rem;
      padding: 0.5rem;
      font-size: 1rem;
      width: 100%;
      box-sizing: border-box;
    }
    .result { margin-top: 0.5rem; font-weight: bold; }
    .better { background-color: #d4edda !important; }
    .worse { background-color: #f8d7da !important; }
    .neutral { background-color: #ffffff !important; }
    #imagePreview {
      max-width: 100%;
      margin-top: 1rem;
    }
    .crop-controls { display: flex; justify-content: space-between; gap: 0.5rem; margin-top: 0.5rem; }
  </style>
</head>
<body>
  <h2>üì∏ ‡∏´‡∏£‡∏∑‡∏≠ üìù ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>

  <div class="row neutral" id="row1">
    <p><strong>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ 1</strong></p>
    <input type="file" accept="image/*" onchange="loadImage(event)">
    <div class="crop-controls">
      <button onclick="cropAndOcr('amount0')">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì</button>
      <button onclick="cropAndOcr('price0')">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤</button>
    </div>
    <img id="imagePreview" style="display:none"/>
    <input type="number" placeholder="‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì (‡πÄ‡∏ä‡πà‡∏ô 700)" onchange="manualInput(0)" id="amount0">
    <input type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)" onchange="manualInput(0)" id="price0">
    <div class="result" id="result1">‡∏´‡∏ô‡πà‡∏ß‡∏¢/‡∏ö‡∏≤‡∏ó: -</div>
  </div>

  <div class="row neutral" id="row2">
    <p><strong>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ 2</strong></p>
    <input type="file" accept="image/*" onchange="processImage(event, 1)">
    <input type="number" placeholder="‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì (‡πÄ‡∏ä‡πà‡∏ô 500)" onchange="manualInput(1)" id="amount1">
    <input type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)" onchange="manualInput(1)" id="price1">
    <div class="result" id="result2">‡∏´‡∏ô‡πà‡∏ß‡∏¢/‡∏ö‡∏≤‡∏ó: -</div>
  </div>

  <div class="row neutral" id="row3">
    <p><strong>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ 3</strong></p>
    <input type="file" accept="image/*" onchange="processImage(event, 2)">
    <input type="number" placeholder="‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì (‡πÄ‡∏ä‡πà‡∏ô 300)" onchange="manualInput(2)" id="amount2">
    <input type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)" onchange="manualInput(2)" id="price2">
    <div class="result" id="result3">‡∏´‡∏ô‡πà‡∏ß‡∏¢/‡∏ö‡∏≤‡∏ó: -</div>
  </div>

  <script>
    const rows = [
      { amount: null, price: null, element: document.getElementById("row1"), result: document.getElementById("result1") },
      { amount: null, price: null, element: document.getElementById("row2"), result: document.getElementById("result2") },
      { amount: null, price: null, element: document.getElementById("row3"), result: document.getElementById("result3") }
    ];

    let cropper;

    function loadImage(event) {
      const image = document.getElementById("imagePreview");
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        image.src = reader.result;
        image.style.display = 'block';
        if (cropper) cropper.destroy();
        cropper = new Cropper(image, { viewMode: 1 });
      };
      reader.readAsDataURL(file);
    }

    function cropAndOcr(targetId) {
      if (!cropper) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô");
      const croppedCanvas = cropper.getCroppedCanvas();
      Tesseract.recognize(croppedCanvas, 'tha+eng').then(({ data: { text } }) => {
        const match = text.match(/\d+(\.\d+)?/);
        if (match) {
          document.getElementById(targetId).value = match[0];
          const index = parseInt(targetId.replace(/\D/g, ''));
          manualInput(index);
        } else {
          alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å");
        }
      });
    }

    function processImage(event, index) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = () => {
        Tesseract.recognize(reader.result, 'tha+eng').then(({ data: { text } }) => {
          const priceMatch = text.match(/‡∏£‡∏≤‡∏Ñ‡∏≤\s*(\d+(\.\d+)?)/i);
          const volumeMatch = text.match(/(\d+(\.\d+)?)\s*(ml|‡∏•‡∏¥‡∏ï‡∏£|cc|‡∏Å\.?‡∏•)/i);

          if (priceMatch) document.getElementById(`price${index}`).value = priceMatch[1];
          if (volumeMatch) document.getElementById(`amount${index}`).value = volumeMatch[1];

          manualInput(index);
        });
      };
      reader.readAsDataURL(file);
    }

    function manualInput(index) {
      const amount = parseFloat(document.getElementById(`amount${index}`).value);
      const price = parseFloat(document.getElementById(`price${index}`).value);

      if (!isNaN(amount) && !isNaN(price) && price > 0) {
        const value = amount / price;
        rows[index].amount = amount;
        rows[index].price = price;
        rows[index].value = value;
        rows[index].result.textContent = `‡∏´‡∏ô‡πà‡∏ß‡∏¢/‡∏ö‡∏≤‡∏ó: ${value.toFixed(2)}`;
      } else {
        rows[index].amount = null;
        rows[index].price = null;
        rows[index].value = null;
        rows[index].result.textContent = '‚ùå ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö';
      }

      compareValues();
    }

    function compareValues() {
      let max = -Infinity;
      rows.forEach(row => row.element.classList.remove("better", "worse", "neutral"));

      const values = rows.map(r => r.value);
      values.forEach(v => { if (v !== null && v > max) max = v; });

      rows.forEach((row, i) => {
        if (row.value === null) {
          row.element.classList.add("neutral");
        } else if (row.value === max) {
          row.element.classList.add("better");
        } else {
          row.element.classList.add("worse");
        }
      });
    }
  </script>
</body>
</html>
