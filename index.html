<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏û</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
      background-color: #f0f0f0;
    }
    h2 { text-align: center; }
    .row {
      background-color: #fff;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 10px;
      transition: background-color 0.3s;
    }
    input[type=file] {
      margin-top: 0.5rem;
    }
    .result { margin-top: 0.5rem; font-weight: bold; }
    .better { background-color: #d4edda !important; }
    .worse { background-color: #f8d7da !important; }
    .neutral { background-color: #ffffff !important; }
  </style>
</head>
<body>
  <h2>üì∏ ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ 3 ‡∏ä‡∏¥‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏û</h2>

  <div class="row neutral" id="row1">
    <p><strong>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ 1</strong></p>
    <input type="file" accept="image/*" onchange="processImage(event, 0)">
    <div class="result" id="result1">‡∏´‡∏ô‡πà‡∏ß‡∏¢/‡∏ö‡∏≤‡∏ó: -</div>
  </div>

  <div class="row neutral" id="row2">
    <p><strong>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ 2</strong></p>
    <input type="file" accept="image/*" onchange="processImage(event, 1)">
    <div class="result" id="result2">‡∏´‡∏ô‡πà‡∏ß‡∏¢/‡∏ö‡∏≤‡∏ó: -</div>
  </div>

  <div class="row neutral" id="row3">
    <p><strong>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ 3</strong></p>
    <input type="file" accept="image/*" onchange="processImage(event, 2)">
    <div class="result" id="result3">‡∏´‡∏ô‡πà‡∏ß‡∏¢/‡∏ö‡∏≤‡∏ó: -</div>
  </div>

  <script>
    const rows = [
      { amount: null, price: null, element: document.getElementById("row1"), result: document.getElementById("result1") },
      { amount: null, price: null, element: document.getElementById("row2"), result: document.getElementById("result2") },
      { amount: null, price: null, element: document.getElementById("row3"), result: document.getElementById("result3") }
    ];

    function processImage(event, index) {
      const file = event.target.files[0];
      if (!file) return;

      rows[index].result.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...';

      const reader = new FileReader();
      reader.onload = () => {
        Tesseract.recognize(reader.result, 'tha+eng').then(({ data: { text } }) => {
          const priceMatch = text.match(/‡∏£‡∏≤‡∏Ñ‡∏≤\s*(\d+(\.\d+)?)/i);
          const volumeMatch = text.match(/(\d+(\.\d+)?)\s*(ml|‡∏•‡∏¥‡∏ï‡∏£|cc|‡∏Å\.?‡∏•)/i);

          if (priceMatch && volumeMatch) {
            const price = parseFloat(priceMatch[1]);
            const amount = parseFloat(volumeMatch[1]);
            const value = amount / price;

            rows[index].amount = amount;
            rows[index].price = price;
            rows[index].value = value;
            rows[index].result.textContent = `‡∏´‡∏ô‡πà‡∏ß‡∏¢/‡∏ö‡∏≤‡∏ó: ${value.toFixed(2)}`;
          } else {
            rows[index].amount = null;
            rows[index].price = null;
            rows[index].value = null;
            rows[index].result.textContent = '‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤';
          }

          compareValues();
        });
      };
      reader.readAsDataURL(file);
    }

    function compareValues() {
      let max = -Infinity;
      rows.forEach(row => row.element.classList.remove("better", "worse", "neutral"));

      const values = rows.map(r => r.value);
      values.forEach(v => { if (v !== null && v > max) max = v; });

      rows.forEach((row, i) => {
        if (row.value === null) {
          row.element.classList.add("neutral");
        } else if (row.value === max) {
          row.element.classList.add("better");
        } else {
          row.element.classList.add("worse");
        }
      });
    }
  </script>
</body>
</html>
